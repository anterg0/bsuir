<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <style>
		.cour {
			font-family: 'Courier New', Courier, monospace;
			font-weight: bold;
			font-size: 25pt;
			line-height: 1;
		}
        .courS {
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
			font-size: 15pt;
			line-height: 1;
        }
		h1 {
			/*название раздела*/
			font-size: 40pt;
			text-align: center;
		}

		h2 {
			/*название параграфа*/
			font-size: 35pt;
		}

		h3 {/*пропущенный материал*/
            font-size: 20pt; 
            text-decoration: underline;
            color: #808080;
            text-align: center;
        } 

		p {
			font-size: 25pt;
			line-height: 1;
		}
        .p3 {
            font-size: 25pt;
			line-height: 1;
        }
		figure img {
			width: 75%;
			height: 75%;
		}

		.fig {
			align-items: center;
			justify-content: center;
			display: block;
			text-align: center;
			margin-top: 0;
			margin-bottom: 100px;
			font-size: 23pt;
		}

		table,
		th,
		td {
			border: 1px solid black;
			border-collapse: collapse;
			padding: 10px;
			font-size: 25pt;
		}
	</style>
</head>
<body>
    <h1>13 Средства безопасности в вычислительных системах</h1>
    <p>
        Средства обеспечения безопасности занимают особое положение среди компонентов системы: они взаимодействуют с большинством других подсистем и влияют на их работу. Подсистема безопасности рассматривается обычно как обособленная, но обращения к ней должны быть встроены в систему начиная с низших уровней.
    </p>
    <h2>13.1 Угрозы, защищаемые объекты, задачи подсистемы безопасности</h2>
    <p>
        Так или иначе, защита в вычислительной системе относится к информации в широком смысле.
    </p>
    <p>
        К <b>защищаемым объектам</b> (видам защищаемой информации) в первую очередь относятся:
    </p>
    <p>
        – программы – защита от несанкционированного использования, т.е. выполнения
    </p>
    <p>
        – данные – защита он несанкционированного считывания и/или изменения; здесь в роли данных могут выступать также и программы в виде выполняемых файлов.
    </p>
    <p>
        <b>Субъектами</b> подсистемы безопасности выступают <b>пользователи</b> системы, однако они всегда представлены <b>процессами</b>, выполняющимися от их имени. Субъекты могут осуществлять легальный (санкционированный) доступ к объектам либо быть источниками <b>угроз</b>.
    </p>
    <p>
        В качестве <b>угроз</b> защищаемым объектам рассматриваются:<br>
        – несанкционированное использование (программ)<br>
        – утечка или хищение (несанкционированное использование данных)<br>
        – несанкционированное изменение или искажение (данных)
        – уничтожение
    </p>
    <p>
        Понятие несанкционированного доступа (<b>НСД</b>) считается устаревшим ввиду излишней обобщенности.
    </p>
    <p>
        Угрозы могут исходить не только от субъектов, но и от иных внешних факторов, например физических (особенно искажение и уничтожение данных).
    </p>
    <p>
        В рамках системы безопасности имеется в виду обычно защита от ущерба при сознательных (не обязательно умышленных) действий пользователя или программного обеспечения. Защита от случайных повреждений относится к обеспечению надежнос­ти, хотя «побочным эффектом» системы безопасности может быть и повышение надежности.
    </p>
    <p>
        <b>Функции</b> подсистемы безопасности могут быть разделены на три основные группы:<br>
        – <b>Идентификация</b> пользователей<br>
        – <b>Управление доступом</b>, в первую очередь ограничение доступа<br>
        – <b>Аудит</b>: документирование (протоколирование) действий пользователя или программ пользователя.
    </p>
    <p>
        <b>Уровни</b> действия средств обеспечения безопасности:<br>
        – Физическая защита информации на носителях и в средах передачи<br>
        – Криптографическая защита информации<br>
        – Защита от несанкционированного использования и/или изменения на уровне <b>прав доступа</b><br>
        – Общая защита от проникновения нежелательных пользователей в систему<br>
        – Организационные меры ограничения доступа
    </p>
    <p>
        Организационные меры обеспечения безопасности принято отделять от технических. <br>Аналогично, при оценке технических средств безопасности агентурные методы проникновения обычно не учитывают.
    </p>
    <p>
        Ключевые понятия для средств безопасности: права и привилегии:
    </p>
    <p>
        <b>Право</b> – разрешение конкретному пользователю выполнять конкретные действия над конкретным объектом
    </p>
    <p>
        <b>Привилегия</b> – разрешение выполнять определенные действия в системе в целом
    </p>
    <figure class="fig">
        <img src="./13-Права.png">
        <figcaption>Применение прав</figcaption>
    </figure>
    <p>
        Основные <b>требования</b> к системе:<br>
        – Целостность и полнота (принцип «слабого звена»)<br>
        – Совместимость с действующими программными и аппаратными средствами (желательно прозрачность)<br>
        – Экономичность<br>
        – Удобство в использовании.
    </p>
    <p>
        Последние два требования предполагают адекватность затрат на поддержание системы безопасности ожидаемым угрозам и потерям.
    </p>
    <p>
        Пример конкретного набора формализованных требований к уровню безопасности <b>C2</b> министерства обороны США:
    </p>
    <p>
        – Управление доступом к ресурсам: возможность разрешать или запрещать доступ к указанным ресурсам как отдельным пользователям, так и группам пользователей
    </p>
    <p>
        – Защита памяти, в том числе и от возможного прочтения содержимого памяти даже после ее освобождения
    </p>
    <p>
        – Регистрация всех пользователей в системе под уникальными идентификаторами и персонификация всех контролируемых системой действий пользователей
    </p>
    <p>
        – Исключительное право системного администратора контроли­ровать выполнение действий, относящихся к безопасности;
    </p>
    <p>
        – Защита системы от вмешательства в нее – например, от модификации системного кода в памяти или системных файлов на диске.
    </p>
    <p>
        В качестве количественных критериев оценки системы безопасности часто выступают:<br>
        – Время преодоления (также, возможно, время обнаружения нарушений и реагирования на них)<br>
        – Затраты на поддержание (в широком смысле)
    </p>
    <p>
        Нередко применяется подход к оценке, основанный на моделях из теории игр: преодоление системы защиты и ее совершенст­вование рассматриваются как одновременно протекающие процессы в рамках стратегий противоборствующих сторон.
    </p>
    <h2>13.2 Подсистема безопасности Windows</h2>
    <h2>13.2.1 Общая характеристика</h2>
    <p>
        Наличие системы безопасности свойственно ОС семейства Win NT, т.е. собственно NT, 2000, XP и последующим. ОС Win 9x, будучи ориентированы на индивидуальное «настольное» использование, практически лишены средств поддержания безопасности, имеются лишь простейшие механизмы идентификации и ограничения подключения, которые несложно преодолеть. <br>Аналогично, файловые системы NTFS имеют встроенные сред­ства защиты файлов (идентификация владельца), FAT – нет.
    </p>
    <p>
        Windows NT считается удовлетворяющей уровню безопасности C2 Министерства обороны США, но лишь при выполнении ряда дополнительных условий
    </p>
    <p>
        Действие подсистемы безопасности основано на использовании наборов привилегий и прав. 
    </p>
    <p>
        <b>Объекты безопасности</b> (защищаемые объекты) – объекты, которые требуют защиты от угроз и могут быть защищены от них, т.е. объекты, для которых предусмотрены хранение и контроль прав доступа (это большинство системных объектов): <br>
        – <b>файлы</b> и другие именованные объекты файловой системы<br>
        – «<b>пользователи</b>» (окна приложений – <b>window station</b> – и их меню)<br>
        – <b>объекты ядра</b> системы (память, ISO, процессы, потоки и т.д. и их дескрипторы)<br>
        – <b>реестр</b> (ключи реестра)<br>
        – <b>службы</b> (программы в режиме службы – <b>service</b>)<br>
        – определяемые пользователем («частные» – <b>private</b>).
    </p>
    <p>
        Механизмы обеспечения безопасности едины для всех типов объектов (при различных системных вызовах, инициирующих обращение к этим механизмам).
    </p>
    <p>
        Если параметры безопасности конкретного объекта не описаны, в действие вступают правила «по умолчанию»:<br>
        – принадлежащие ядру системные объекты – доступны всем пользователям<br>
        – объекты файловой системы и приравниваемые к ним ключи реестра – доступны владельцу (создателю), его потомкам и процессам его основной группы
    </p>
    <p>
        При попытке выполнения контролируемого действия выполняется проверка на соответствие его либо правам пользователя в отношении данного объекта, либо привилегиям пользователя. В рамках принятых концепций средства обеспечения безопасности в большинстве случаев применяются автоматически. Реально вмешиваться в работу подсистемы приходится в основном при разработке специфического ПО, при программировании многопользовательских задач либо при необходимости защищать собственные (нестандартные) объекты. 
    </p>
    <figure class="fig">
        <img src="./13-Безопасность_Win.png">
        <figcaption>Действие подсистемы безопасности Windows (схематично)</figcaption>
    </figure>
    <h2>13.2.2 Используемые структуры данных</h2>
    <p>
        Общая организация подсистемы безопасности Windows сложная и многоуровневая
    </p>
    <h2>Идентификация пользователей и групп</h2>
    <p>
        Для идентификации пользователей и групп в рамках системы безопасности Win NT используется их <b>Security Identifier</b> (<b>SID</b>, не путать с ID сеанса в UNIX).
    </p>
    <h2>Элементы управления доступом</h2>
    <p>
        «Материальный носитель» прав доступа – <b>элементы управления доступом</b> (<b>Access Control Element/Entry</b> – <b>ACE</b>). <br>Элементы ACE объединяются в списки ACL (см. ниже).
    </p>
    <p>
        Каждый элемент ACE описывает однотипные права для одного пользователя или группы:<br>
        – <b>SID</b> – идентификатор пользователя (группы)<br>
        – <b>тип</b> элемента – характер прав<br>
        – <b>маска</b> прав – действия, на которые распространяются права.
    </p>
    <p>
        <b>Типы</b> ACE:<br>
        – <span class="cour">ACCESS_ALLOWED_ACE_TYPE</span> – действие разрешено<br>
        – <span class="cour">ACCESS_DENIED_ACE_TYPE</span> – действие запрещено<br>
        – <span class="cour">SYSTEM_AUDIT_ACE_TYPE</span> – действие подвергается аудиту (протоколируется)
    </p>
    <p>
        <b>Маска</b> прав – 32-разрядная, разряды показывают наличие (или блокировку, в зависимости от типа) соответствующих разрешений. Наборы прав различаются в зависимости от объектов, основные 4 флага едины для всех объектов:<br>
        – <span class="cour">GENERIC_READ</span><br>
        – <span class="cour">GENERIC_WRITE</span><br>
        – <span class="cour">GENERIC_EXECUTE</span><br>
        – <span class="cour">GENERIC_ALL</span>
    </p>
    <p>
        В соответствии с типами элементов ACE определены структуры для их представления:<br>
        – <span class="cour">ACL_HEADER</span> – заголовок<br>
        – <span class="cour">ACCESS_ALOWED_ACE</span> – разрешающая запись<br>
        – <span class="cour">ACCESS_DENIED_ACE</span> – запрещающая запись
    </p>
    <h2>Дескрипторы безопасности</h2>
    <p>
        Связь элементов управления доступом с конкретным объектом – <b>дескриптор безопасности</b> (<b>Security Descriptor</b>, <b>SD</b>), содержащий <b>SID</b> владельца (индивидуального и основной группы) состоящие из ACE <b>списки управления доступом</b> (<b>Access Control List</b>, <b>ACL</b>). 
    </p>
    <p>
        Дескрипторы безопасности поддерживаются только в Win NT начиная с версии 3.1 и в последующих ОС. В Win 9x поддержки не было.
    </p>
    <p>
        Два списка в одном дескрипторе безопасности:<br>
        – <b>дискреционный</b> список управления доступом (<b>Discretionary Access Control List</b> – <b>DACL</b>) – управление правами<br>
        – <b>системный</b> список управления доступом (<b>System Access Control List</b> – <b>SACL</b>) – управление протоколированием
    </p>
    <p>
        Соблюдаются условности:<br>
        – Полное отсутствие списка (пустой указатель на список) – права «по умолчанию»<br>
        – Пустой список – отсутствие прав доступа<br>
        – Запрещающие записи имеют приоритет перед разрешающи­ми, но вплоть до версии Win NT 4.0 это обеспечивалось лишь размещением их в списке раньше разрешающих.
    </p>
    <p>
        Таким образом, содержимое дескриптора безопасности:<br>
        – SID владельца<br>
        – SID основной группы владельца<br>
        – DACL<br>
        – SACL<br>
        – дополнительная информация.
    </p>
    <p>
        Два формата дескриптора: <br>
        – <b>абсолютный</b> (<b>absolute</b>) – дескриптор содержит указатели на управляющую информацию. <br>
        – <b>относительный</b> (<b>self-relative</b>) – поля находятся непосредственно в дескрипторе, следуя друг за другом. 
    </p>
    <p>
        Все системные вызовы работают с дескрипторами SD в абсолютном формате. относительный формат служит для записи на диск и передачи между процессами (сериализация).
    </p>
    <p>
        Внутренняя реализация структуры дескриптора безопасности по соображениям безопасности считается закрытой. Для работы с дескрипторами определены соответствующие системные функции.
    </p>
    <h2>Атрибут безопасности</h2>
    <p>
        <b>Атрибут безопасности</b> служит для связывания объектов с их наборами прав. Применим практически для всех системных объектов, а также пользовательских объектов. 
    </p>
    <p>
        Описывается структурой SECURITY_ATTRIBUTE:<br>
        – <span class="cour">nLength</span> – размер структуры;<br>
        – <span class="cour">lpSecurityDescriptor</span> – указатель на дескриптор (описатель) безопасности объекта;<br>
        – <span class="cour">bInheritHandle</span> – флаг разрешения наследования атрибута.
    </p>
    <p>
        Сопоставление атрибута объекту происходит при его (объекта) создании или открытии. Передача осуществляется по указателю LPSECURITY_ATTRIBUTE, пустой указатель (NULL) – игнорирование параметра. Атрибуты безопасности поддерживаются начиная с версий Win 95 и Win NT 3.1 соответственно, но в Win 9x переданный атрибут безопасности игнорируется.
    </p>
    <h2>13.2.3 API подсистемы безопасности (фрагментарно)</h2>
    <p>
        Для формирования дескрипторов служат функция:<br>
            <span class="cour">&nbsp;InitializeSecurityDescriptor();</span>
    </p>
    <P>
        Функция создает работоспособный, но фактически «пустой» дескриптор: без списков, все управляющие флаги <span class="cour">FALSE</span>.
    </P>
    <p>
        Получение информации о SID:<br>
            <span class="cour">&nbsp;LookupAccountName();<br>
            &nbsp;LookupAccountSid();</span>
    </p>
    <p>
        Создание, формирование, модификация SID:<br>
        <span class="cour">&nbsp;BOOL AllocateAndInitializeSid();<br>
            &nbsp;BOOL InitializeSid();<br>
            &nbsp;FreeSid();<br>
            &nbsp;CopySid();<br>
            &nbsp;IsValidSid();<br>
            &nbsp;GetLengthSid();<br>
            &nbsp;EqualSid();</span>
    </p>
    <p>
        Списки ACL:<br>
            <span class="cour">&nbsp;InitializeAcl()<br>
                &nbsp;AddAccessDeniedAce()<br>
                &nbsp;AddAccessAlowedAce()<br>
                &nbsp;SetSecurityDescriptorAacl()</span> //привязка к SD
    </p>
    <p>
        Пример:<br>
        <span class="cour">&nbsp;SECURITY_ATTRIBUTES sa;<br>
        &nbsp;SECURITY_DESCRIPTOR sd;<br>
        &nbsp;InitializeSecurityDescriptor(&sd, SECURITY_DESCRIPTOR_REVISION);<br>
        &nbsp;SetSecurityDescriptorDacl(&sd,TRUE,NULL,FALSE);<br>
        &nbsp;sa.nLength = sizeof(sa);<br>
        &nbsp;sa.bInheritHandle = TRUE;<br>
        &nbsp;sa.lpSecurityDescriptor = &sd;</span><br>
        Здесь список ACL отсутствует, объект будет общедоступным.
    </p>
    <p>
        Явная проверка прав доступа:<br>
            <span class="cour">&nbsp;BOOL AccessCheck();</span>
    </p>
    <p>
        Создание «частного» (private) защищаемого объекта<br>
            <span class="cour">&nbsp;CreatePrivateObjectSecurity();</span>
    </p>
    <p>
        При регистрации пользователя его пароль сверяется с инфор­мацией, хранящейся в системной базе данных. В случае успеха на основании этой информации ему назначается т.н. <b>маркер</b> или <b>токен доступа</b> (<b>access token</b>), в данном случае это <b>основной токен персонализации</b> (<b>impersonation token</b>) Этот маркер в дальнейшем будет присваиваться каждому процессу, который запустит пользователь. <br>Маркер содержит информацию о пользователе, группе, приви­легиях и правах доступа. При попытке обратиться к объекту выполняется поиск в списке ACL этого объекта элемента ACE, соответствующего обратившемуся процессу. <br>На основе сравнения маркера доступа и ACE принимается решение о разрешении или запрещении доступа процесса к объекту. 
    </p>
    <p>
        Помимо основного, можно получить т.н. <b>специальный</b> токен персонализации, который используется для выполнения действий от имени другого процесса и с его правами. Обычное («легальное») применение данного механизма – исполнение сервером действий от имени своего клиента, что включает контроль прав соответствующего рядового пользователя (сервер считается заведомо защищенным и пользующимся большим доверием, чем клиент).
    </p>
    <p>
        Уровни:<br>
        – <span class="cour">SecurityAnonymous</span> – нет идентификационной информации о клиенте<br>
        – <span class="cour">SecurityIdentification</span> – можно плучить идентификационную информацию<br>
        – <span class="cour">SecurityImpersonation</span> – разрешена персонификация (работа от имени данного процесса)
    </p>
    <p>
        Вход пользователя и получение токена:<br>
        <span class="cour">&nbsp;BOOL LogonUser()<br>
            &nbsp;BOOL OpenProcessToken(), OpenThreadToken()<br>
            &nbsp;ImpersonateLoggedOnUser()</span> //с токеном другого процесса<br>
            <span class="cour">&nbsp;ImpersonateSelf()</span> //смена уровня собственного токена
    </p>
    <h2>13.3 Служба Kerberos</h2>
    <p>
        Механизм (сервис) <b>Kerberos</b> (<b>The Kerberos Network Authentication Service V5</b>) описан в RFC 1510 (дополнения в RFC 1964) и призван обеспечить безопасное взаимодействие между клиентами и серверами в распределенной системе.
    </p>
    <p>
        В крупных сложных системах серьезной проблемой является потенциальное наличие «враждебных» серверов, в т.ч. и предоставляющих вполне «легальные» услуги, но при этом выполняющих деструктивные функции, например, собирающие пароли пользователей (клиентов). 
    </p>
    <p>
        Поскольку в большой системе количество серверов велико, и многие из их относятся к «малознакомым», вероятность данной угрозы достаточно высока. Обладая же паролем клиента, злоумышленник получает доступ к его ресурсам на других серверах, возможность исполнять действия от его имени и т.д. 
    </p>
    <p>
        Вариантом решения проблемы является сосредоточение функций идентификации (аутентификации) в немногих хорошо защищенных центрах, которые управляют процессом раздачи прав. Подобная схема «клиент – сервер – центр аутентифи­кации» называется трехсторонней, или «<b>с доверительной третьей стороной</b>» (<b>trusted third-party</b>). 
    </p>
    <p>
        Сам принцип аутентификации с точки зрения пользователя при этом не изменяется, однако общается он уже не непосред­ственно с сервером, а с «третьей стороной» – специальным <b>сервером аутентификации</b>.
    </p>
    <p>
        Согласно Kerberos, обмен между клиентом и сервером аутенти­фикации (наиболее уязвимый отрезок) защищается криптогра­фически – <b>симметричным</b> шифрованием с <b>секретным ключом</b> (<b>secret key</b> или <b>private key</b>), стандартно используется алгоритм <b>DES</b>. Kerberos-сервер хранит информацию о своих клиентах, включая их секретный ключ. 
    </p>
    <p>
        Приняты следующие термины:<br>
            – <b>Key Distribution Center</b> (<b>KDC</b>) – центр распределения ключей, сервер системы аутентификации<br>
            – <b>Ticket</b> («<b>билет</b>») – разрешение, набор информации, пересы­лаемый "целевому" серверу вместо пароля пользователя<br>
            – <b>Ticket-Granting Server</b> (<b>TGS</b>) – сервер выдачи «билетов»<br>
            – <b>Ticket-Granting Ticket</b> (<b>TGT</b>) – «билет предоставления билетов».
    </p>
    <p>
        Кроме постоянного секретного ключа в обмене участвует также <b>сеансовый ключ</b> (<b>session key</b>), которым защищаются переда­ваемые билеты. Дополнительным средством идентификации их подлинности служит <b>временная метка</b> (<b>time stamp</b>), играющая роль <b>имитовставки</b> и обеспечивающая уникальность каждой посылки и противодействие повторному использованию перехваченных данных.
    </p>
    <p>
        Имея полученный от KDC билет, клиент пересылает его серве­ру вместо своего пароля. Сервер, поддерживающий Kerberos (т.е. способный распознать эту ситуацию) обращается к тому же KDC за подтверждением подлинности билета и выполняет запрос только после положительного ответа. Воспользоваться перехваченным билетом явным образом нельзя, т.к. он содер­жит временную метку и устаревает. 
    </p>
    <h3>Рис – Трехсторонняя схема аутентификации</h3>
    <p>
        Таким образом:<br>
            – «базовый» секретный ключ клиента известен только клиенту и KDC;<br>
            – текущий обмен билетами защищен криптографически с временным ключом;<br>
            – имитовставки усложняют наблюдение за обменом и препятствуют использованию перехваченных посылок.
    </p>
    <p>
        В рамках Kerberos описан ряд алгоритмов (протоколов) обмена между участниками взаимодействия. Для связи используются протоколы TCP и UDP, порт <span class="cour">88</span>. В виде, описанном в RFC, Kerberos рассчитан на использование в любых сетях вплоть до глобальных: варианты взаимного расположения участников обмена ограничено только их достижимостью посредством обычных сетевых протоколов.
    </p>
    <p>
        Начиная с Windows 2000 декларируется соответствие специфи­кации Kerberos, причем механизм Kerberos включается в ее подсистему безопасности прозрачно. В состав «билета» включается идентификатор объекта безопасности (SID) пользователя.
    </p>
</body>