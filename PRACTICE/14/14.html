<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <style>
		.cour {
			font-family: 'Courier New', Courier, monospace;
			font-weight: bold;
			font-size: 25pt;
			line-height: 1;
		}
        .courS {
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
			font-size: 15pt;
			line-height: 1;
        }
		h1 {
			/*название раздела*/
			font-size: 40pt;
			text-align: center;
		}

		h2 {
			/*название параграфа*/
			font-size: 35pt;
		}

		h3 {
			/*?*/
			font-size: 30pt;
		}

		p {
			font-size: 25pt;
			line-height: 1;
		}
        .p3 {
            font-size: 25pt;
			line-height: 1;
        }
		figure img {
			width: 75%;
			height: 75%;
		}

		.fig {
			align-items: center;
			justify-content: center;
			display: block;
			text-align: center;
			margin-top: 0;
			margin-bottom: 100px;
			font-size: 23pt;
		}

		table,
		th,
		td {
			border: 1px solid black;
			border-collapse: collapse;
			padding: 10px;
			font-size: 25pt;
		}
	</style>
</head>
<body>
    <h1>14 Планирование</h1>
    <p>
        (Часть темы управления процессами. Перенос в курс ОСиС)
    </p>
    <h2>14.1 Планирование выполнения процессов (потоков)</h2>
    <h2>14.1.1 Задачи планирования</h2>
    <p>
        – выбор момента смены активного процесса/потока<br>
        – выбор нового процесса/потока (из очереди готовых)<br>
        – переключение контекстов процессов/потоков
    </p>
    <p>
        Фактически задачи планирования ставятся шире, чем распределение времени процессора по какому-либо критерию (например, на основании приоритета). Планируются также и другие ресурсы, в первую очередь память и устройства (каналы) ввода-вывода, при этом используются схожие в целом подходы, методы и алгоритмы.
    </p>
    <h2>14.1.2 Уровни планирования</h2>
    <p>
        1) Планировщик доступа – управление поступлением новых задач в систему.<br>
        2) Планировщик памяти – размещение и хранение задач.<br>
        3) Планировщик процессора – выполнение задач.
    </p>
    <p>
        Чаще обсуждается компонент ОС, решающий задачи планирования выполнения – <b>планировщик задач</b>, <b>планировщик процессов</b>, <b>диспетчер потоков</b>, <b>process manager</b> и т.д.
        <br>Но он взаимодействует с другими уровнями – использует их и зависит от них. Например, <b>диспетчер памяти</b> может выполнять запросы на выделение памяти или блокировать их в зависимости от параметров процесса – инициатора запроса (в реально многозадачной среде с высокой интенсивностью таких запросов).
    </p>
    <h2>14.1.3 Требования к планировщику</h2>
    <h3>Общие требования – для всех систем:</h3>
    <p>
        – справедливость<br>
        – контролируемость<br>
        – баланс занятости, сбалансированная загрузка частей системы
    </p>
    <p>
        <b>Справедливость</b> планирования – все процессы рано или поздно получают необходимые ресурсы и возможность выполняться.
        <br>Противоположность – надежность, строгость исполнения приоритетов.
    </p>
    <figure class="fig">
        <img src="./14-Планирование-Справедливость.png">
        <figcaption>Характер планирования</figcaption>
    </figure>
    <p>
        Противоречие – проблема <b>инверсии приоритетов</b>.
    </p>
    <h3>Специфические требования:</h3>
    <p>
        Для систем <b>пакетной</b> обработки:<br>
        – пропускная способность<br>
        – время прохождения заявки («оборотное» время)<br>
        – загрузка, полнота использования ресурсов системы
    </p>
    <p>
        Для <b>интерактивных</b> систем:<br>
        – время отклика<br>
        – соразмерность (соответствие) желаниям пользователя
    </p>
    <p>
        Для систем <b>реального времени</b>:<br>
        – конечность времени реагирования и обработки<br>
        – предсказуемость<br>
        – предотвращение деградации качества
    </p>
    <h2>14.1.4 Основные группы методов (алгоритмов) планирования</h2>
    <p>
        Деление по двум критериям: с квантованием времени или без квантования; с приоритетами или без приоритетов.
    </p>
    <p>
        Критерии не исключают друг друга – возможны и на практике часто используются <b>комбинированные</b> методы
    </p>
    <figure class="fig">
        <img src="./14-Планирование-Комбинации_методов.png">
        <figcaption>Комбинации подходов к планированию</figcaption>
    </figure>
    <p>
        С <b>квантованием</b> времени – основаны на выделении времени процессора короткими порциями – «квантами»
    </p>
    <p>
        Переключение контекста в случаях:<br>
        – завершение активного потока (нормальное или аварийное)<br>
        – переход в состояние ожидания<br>
        – исчерпание выделенного кванта
    </p>
    <p>
        Вариации: неравные кванты, разные дисциплины очередей, ...
    </p>
    <p>
        С <b>приоритетами</b> – выбор контекста на основании приоритетов готовых к выполнению процессов (потоков)
    </p>
    <p>
        Переключение контекста в случаях:<br>
        – завершение активного потока (нормальное или аварийное)<br>
        – переход в состояние ожидания<br>
        – появление более приоритетного процесса (потока)
    </p>
    <p>
        Виды приоритетов: абсолютные и относительные
    </p>
    <p>
        <b>Относительные</b> приоритеты – активный процесс (поток) не прерывается, переключение контекстов только по окончании кванта.
    </p>
    <P>
        Результат – <b>невытесняющая</b> (<b>not-preemptive</b>) многозадачность 
    </P>
    <p>
        <b>Абсолютные</b> приоритеты – переключение контекста немедленно при появлении более приоритетного процесса
    </p>
    <p>
        Результат – <b>вытесняющая</b> (<b>preemptive</b>) многозадачность
    </p>
    <p>
        (Очевидно, после завершения активного процесса или перехода его в состояние ожидания переключение контекста будет независимо от границ квантов).
    </p>
    <h2>14.1.5 Дисциплины планирования</h2>
    <h3>Основные типы</h3>
    <p>
        1) Циклические (Round Robin)<br>
        2) Приоритетные<br>
        3) «Кратчайший следующий» (оценка «устаревания» задач)<br>
        4) Гарантированное планирование (учет доли обязательно предоставляемого времени)<br>
        5) Лотерейные (случайные), в т.ч. с неравенством<br>
        6) «Справедливые» с учетом владельца и и др. параметров процесса
    </p>
    <p>
        Дополнительные факторы и критерии выбора дают смешанные и модифицированные дисциплины, применяемые на практике.
    </p>
    <h3>Некоторые базовые дисциплины планирования</h3>
    <p>
        <b>FCFS</b> (<b>F</b>irst <b>C</b>ome <b>F</b>irst <b>S</b>erve) – очередь, без вытеснения. Нет бесконечно ждущих процессов (если активный не зависнет).
    </p>
    <p>
        <b>RR</b> (<b>R</b>ound <b>R</b>obin), карусельная – циклическое планирование с квантованием. Идеально «справедливое» планирование.
    </p>
    <p>
        <b>SRR</b> (<b>Selfish RR</b>), «эгоистичная» карусель – вытесняющее циклическое планирование с преимуществом текущего активного процесса.
    </p>
    <p>
        <b>SJN</b> (<b>S</b>hortest <b>J</b>ob <b>N</b>ext) – невытесняющая, преимущество «коротких» («быстрых») задач. Минимизация штрафов за потери времени, максимизация пропускной способности для «коротких» задач.
    </p>
    <p>
        <b>PSJN</b> (<b>P</b>reemptive <b>SJN</b>) – то же, но вытесняющая.
    </p>
    <p>
        <b>HPRN</b> (<b>H</b>ighest <b>P</b>enalty <b>R</b>atio <b>N</b>ext) – невытесняющая с динамическими приоритетами, улучшена «справедливость»
    </p>
    <p>
        <b>FB</b> (<b>F</b>oreground – <b>B</b>ackground) – очереди готовых процессов «переднего» и «заднего» плана (приоритет на уровне очередей)
    </p>
    <p>
        <b>MLFB</b> (<b>M</b>ulti-<b>L</b>evel <b>FB</b>) – то же с большим числом очередей, эффективность для интерактивных процессов.
    </p>
    <h2>14.2 Тупики и борьба с тупиками</h2>
    <p>
        <b>Тупик</b> (<b>deadlock</b>) – ситуация, когда несколько взаимодействующих процессов (потоков) блокируют друг друга, обычно при конфликте за ресурсы: каждый из участников владеет частью необходимых ресурсов и ожидает получения остальных, которые заняты другими. Никто не может продолжить работу, соответственно никто не может освободить занятые ресурсы.
    </p>
    <p>
        В терминах критических секций – ситуация вложенности секций: каждый из конкурирующих процессов, уже находясь в критическую секции, ожидает возможности войти в другую, которая в этот момент занята (нарушение базового требования к критическим секциям).
    </p>
    <p>
        Обычно принимается, что процессы самостоятельно выйти из тупика не могут, необходимы дополнительные меры и средства.
    </p>
    <h2>14.2.1 Уровни (задачи) борьбы с тупиками</h2>
    <p>
        1) Предупреждение тупика – выбор стратегии распределения ресурсов<br>
        2) Обнаружение тупика – распознавание ситуации тупика<br>
        3) Развязка тупика – разблокирование участников
    </p>
    <p>
        Решения – компромисс между надежностью и ограничением возможностей и производительности.
    </p>
    <figure class="fig">
        <img src="./14-Планирование-Либеральность.png">
        <figcaption>«Консервативные» и «либеральные» методы решения</figcaption>
    </figure>
    <h2>14.2.2 Предупреждение тупиков</h2>
    <p>
        Стратегия распределения ресурсов (в т.ч., возможно, и процес­сор­ного времени) должна предотвращать возникновение тупика, при необходимости задерживая выполнение критических операций.
    </p>
    <p>
        Стратегии – без дополнительной информации о процессах и с дополнительной информацией.
    </p>
    <h3>Без дополнительной информации</h3>
    <p>
        1) <b>Последовательное</b> выделение – ресурсом (или набором ресурсов) может владеть только один процесс.<br>Отдельные ресурсы из набора могут предоставляться поочередно, но весь набор будет считаться занятым и недоступным для других пользователей.
    </p>
    <p>
        2) «<b>Залповое</b>» выделение – весь набор ресурсов выделяется и освобождается только целиком, даже если запрошена его часть. Необходима поддержка атомарного запроса разнородных ресурсов.
    </p>
    <p>
        3) <b>Иерархическое</b> выделение – иерархия классов ресурсов, где более дефицитный ресурс относится к более высокому уровню. Запросить можно только ресурс с более высокого уровня, чем уже имеющиеся. 
    </p>
    <p>
        Проблема – построение адекватной иерархии.
    </p>
    <h3>С дополнительной информацией</h3>
    <p>
        Различные варианты «<b>алгоритма банкира</b>» на основании предварительных <b>заявок</b>.
    </p>
    <p>
        <b>Реализуемая</b> ситуация – сумма запрошенных ресурсов (в заявках) не превышает наличие ресурсов в системе, при этом никто не превышает свою заявку.
    </p>
    <p>
        <b>Безопасная</b> ситуация – каждый процесс может нормально завершиться, использовав весь объем своей заявки, если до него завершится и освободит ресурсы предыдущий процесс.
    </p>
    <p>
        <b>Опасная</b> ситуация – возможна нехватка ресурсов для очередного процесса. При получении такого запроса на выделение ресурсов может перейти в тупик.
    </p>
    <p>
        Стратегия состоит в удовлетворении запросов до тех пор, пока они не делают ситуацию опасной. Отказ в удовлетворении заявки в безопасной ситуации к тупику не приводит.
    </p>
    <p>
        Также другие близкие алгоритмы, например алгоритм <b>Габермана</b> (адаптирован для работы с одним классом ресурсов).
    </p>
    <p>
        Алгоритмы с предварительными заявками – наиболее либеральные из гарантирующих избегание тупика. Производительность снижается из-за того, что не допускаются также и опасные ситуации, которые не обязательно стали бы тупиковыми.
    </p>
    <h2>14.2.3 Обнаружение тупиков</h2>
    <h3>Политика точного учета</h3>
    <p>
        Возможные ситуации:<br>
            – <b>Не тупиковая</b> – можно выстроить процессы так, что первый из них сможет выполниться и завершиться, удовлетворяя все запросы, а каждый следующий может выполниться и завершиться после завершения предыдущего. <br>(Аналогично определению <b>безопасной</b> ситуации)<br>
            – <b>Тупиковая</b> – выстроить такую последовательность невозможно, есть взаимно блокирующиеся процессы.
    </p>
    <p>
        Ситуацию можно представить графом.
        <br>Граф не обязательно связный.
    </p>
    <figure class="fig">
        <img src="./14-Тупик-Обнаружение.png">
        <figcaption>Граф распределения ресурсов</figcaption>
    </figure>
    <p>
        Граф – не статический, он отражает мгновенное состояние в системе и непрерывно перестраивается. 
    </p>
    <p>
        Преимущества: точное, достоверное, проверяемое решение; возможность оптимально загрузить ресурсы без излишнего резервирования.
    </p>
    <p>
        Недостатки: вычислительно сложная задача, значительные затраты на непрерывный анализ и поиск тупиков.
    </p>
    <p>
        Оптимизация: проверка выполняется только при получении очередного запроса на ресурс, т.к. ситуация может стать тупиковой только в этот момент.<br>
        Выигрыш – общие вычислительные затраты<br>
        Проигрыш – более длительное выполнение запросов
    </p>
    <h3>«Ленивая» политика</h3>
    <p>
        Игнорирование проблемы в расчете на самоорганизацию и малую вероятность действительно неразрешимого тупика («страусовый» алгоритм).
    </p>
    <p>
        Не предсказание и предупреждение тупика, а обнаружение фактически сложившегося тупика и его ликвидация.
    </p>
    <p>
        Недостатки: не гарантирует решение проблемы тупиков.
        <br>Неприемлемо при высоких требованиях к надежности.
    </p>
    <p>
        Преимущества: простота и экономичность решения. 
        <br>Типично для универсальных и «настольных» ОС.
    </p>
    <p>
        Основная мера для повышения надежности – ограничение времени ожидания отдельно взятых потоков, выявление зависших потоков. 
    </p>
    <p>
        Технические решения: использование <b>тайм-аутов</b>, «сторожевых» таймеров (<b>WDT</b>) и т.п. 
    </p>
    <h2>14.2.4 Развязка тупиков</h2>
    <p>
        Так или иначе, прерывание текущего хода выполнения конфликтующих процессов
    </p>
    <p>
        Принудительное <b>высвобождение</b> (<b>выгрузка</b>) <b>ресурса</b> – если возможно (проблема целостности, некорректного состояния ресурса и/или процесса)
    </p>
    <p>
        <b>Откат</b>, <b>восстановление</b> или <b>перезапуск</b> – например, механизм <b>транзакций</b> в БД
    </p>
    <p>
        <b>Уничтожение процесса</b> – проблема выбора наименее ценного (минимизация потерь). Обычно процесс, наименее использующий наиболее дефицитные ресурсы, либо «зависший».
        <br>Методы выбора удаляемого процесса – в общем аналогичны используемым при выгрузке-загрузке страниц памяти.
    </p>
    <h2>14.2.5 Устранение голодания</h2>
    <p>
        «<b>Голодание</b>» (<b>starvation</b>) – систематическое недополучение ресурсов с сохранением потенциальной возможности выполняться (без взаимной блокировки).
        <br>В целом менее критичная проблема.
    </p>
    <p>
        – Строгая <b>очередь</b> без приоритетов – справедливое выделение ресурсов, но риск тупика
        – <b>Приоритеты</b> – более правильная дисциплина выделения ресурсов, но риск «голодания»
        – <b>Динамическая</b> перестройка очереди (динамические приоритеты) – риск инверсии приоритетов
    </p>
</body>